# 0810-VNS-VIAVI_OBSERVER

* **version:** 1.0.0
* **tags:** VIAVI
* **requirements**: Nuage 5.2.3+
* **designer**: Roman Dodin

This Lab demonstrates joint integration between **Nuage Networks VNS** and [**VIAVI Observer Live**](https://www.viavisolutions.com/en-us/products/observerlive) solution. The lab consists of an Organization comprised of a HQ and a branch site deployed over a single underlay (Internet).

Both HQ and a Branch are equipped with an NSG, which in turn runs VIAVI Virtual Agent as a Hosted VNF. In addition to the VIAVI Virtual Agents, Branch1 also sports a Windows 10 machine running a VIAVI Windows Agent.

The automation harness provided with this lab enables a user to demonstrate the following use cases of a joint integration:

* VIAVI VNF deployment and Observer Live service discovery.
* Network test between the sites - proactive, ongoing network link testing performed by VIAVI VNF agents.
* Service validation - establishing visibility between the cloud and on-premises VNF agents.
* Remote user troubleshooting - leveraging Windows machine connected with Nuage Networks VNS and running VIAVI agent.


Once automatically deployed and configured the lab will conform to the following diagram:
![lab](https://gitlab.com/rdodin/pics/wikis/uploads/603ee0b6520a1a08e6d1610f6e988daa/image.png)

The Headquarters site and the branch office are equipped with the [Branch-PC image](https://nuagenetworks.zendesk.com/hc/en-us/articles/360010244033) which allows to generate and analyze traffic as well as run some real-world applications.

# Deployment
The deployment process is powered by [nuxctl](https://nuxctl.nuagex.io) CLI tool. The infrastructure deployment activities will be triggered once a user supply the lab template available in this repo to the `nuxctl` tool.

The lab template is based on the **Nuage Networks 5.3.2 - VNS SD-WAN Portal 3.2.1** NuageX template and has additional infra components defined to support the integration and use cases demonstration.

```bash
# make sure to fill in your nuagex public key information in the lab template
# before running the command
nuxctl create-lab -l nuxctl_0810-vns-viavi_observer.yml --wait
```

# Configuration
When the lab deployment is finished, proceed with automatic lab configuration. Lab configuration automation is saved in a set of [CATS](http://cats-docs.nuageteam.net) scripts contained in a [cats](./cats/) folder of this repo.

## Variables file
The lab configuration can be parameterized by changing the variables in the [vars.robot](./cats/vars.robot) file. Some variables values in this file are marked with `TO_BE_FILLED_BY_A_USER` string and therefore must be provided by a user before running the configuration scripts.

### VNF names
An important requirement of this lab is to have matching VNF names between the Nuage Networks and VIAVI ObserverLive web application.

A recommendation here is to create the Agents in the ObserverLive web app and then use these names in the [vars.robot](./cats/vars.robot) file. Specifically, these names are defined on lines [64](./cats/vars.robot#64) and [65](./cats/vars.robot#65).  
For example, oif the two agents are created with the names `nuage_agent1` and `nuage_agent2` then these names should be set as the VNF names on the above mentioned lines of the variables file.

### Boot ISO
The boot ISO files are generated by the ObserverLive application once the agents are created. Use the download links provided by the app on the lines [74-75](./cats/vars.robot#74-75).

## Starting configuration process
The configuration process will handle all the heavy-lifting of the lab configuration. Starting with overlay objects creation, going through NSG bootstrap and activation, finishing with VNFs creation and deployment.

To launch the configuration sequence a user needs to download CATS to their machine or use CATS in a container.

The following example start the whole configuration process using CATS docker container on a users machine:

```bash
# being in the lab directory (where this README.md file is located)
# flags:
## -X -- stop the execution if error occurs

docker run -t \
  -v ${HOME}/.ssh:/root/.ssh \
  -v `pwd`/cats:/home/tests \
  cats -X /home/tests
```

The configuration ends in a success if every step is marked with the PASS status. The configuration execution log can be found under `cats/reports` directory.

> Note, lab configuration does not create agents in the ObserverLive service, this needs to be carried out manually before running the CATS scripts.

# Use cases

Use cases execution and provisioning are to be carried out by a user manually after the lab configuration finishes. Check with the VIAVI Integration Guide for use cases configuration instructions.